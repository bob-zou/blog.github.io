
<!DOCTYPE html>
<html lang="zh-CN,en,default" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>K8S学习笔记（十四）- K8S的Helm - 书山有路勤为径，学海无涯苦作舟</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="BobZou,"> 
    <meta name="description" content="
Helm v3版本

引入kubernetes上的应用对象，都是由特定的资源描述组成，包括Deployment、Service等，都保存在各自文件中或者集中写在一个配置文件，然后通过kubectl,"> 
    <meta name="author" content="Bob Zou"> 
    <link rel="alternative" href="atom.xml" title="书山有路勤为径，学海无涯苦作舟" type="application/atom+xml"> 
    <link rel="icon" href="https://cdn.jsdelivr.net/gh/bob-zou/blog.github.io/img/favicon.png"> 
    
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

    
<link rel="stylesheet" href="/css/bootstrap.css">

    
<link rel="stylesheet" href="/css/diaspora.css">

<meta name="generator" content="Hexo 5.4.2"></head>

<body class="loading">
    <span id="config-title" style="display:none">书山有路勤为径，学海无涯苦作舟</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="https://blog.zouyapeng.com"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">K8S学习笔记（十四）- K8S的Helm</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">K8S学习笔记（十四）- K8S的Helm</h1>
        <div class="stuff">
            <span>四月 04, 2022</span>
            
  <ul class="post-tags-list" itemprop="keywords"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/k8s/" rel="tag">k8s</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/kubernetes/" rel="tag">kubernetes</a></li></ul>


        </div>
        <div class="content markdown">
            <blockquote>
<p>Helm v3版本</p>
</blockquote>
<h1 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h1><p>kubernetes上的应用对象，都是由特定的资源描述组成，包括Deployment、Service等，都保存在各自文件中或者集中写在一个配置文件，然后通过kubectl apply -f 部署。<br>如果应用只由一个或几个这样的服务组成，上面的部署方式就足够了。<br>但是对于一个复杂的应用，会有很多类似上面的资源描述文件，例如微服务架构应用，组成应用的服务可能多达几十、上百个，如果有更新或回滚应用的需求，可能要修改和维护所涉及到大量的资源文件，而这种组织和管理应用的方式就显得力不从心了。<br>并且由于缺少对发布过的应用进行版本管理和控制，使得kubernetes上的应用维护和更新面临诸多的挑战，主要面临以下的问题：</p>
<ul>
<li>如何将这些服务作为一个整体管理？</li>
<li>这些资源文件如何高效复用？</li>
<li>应用级别的版本如何管理？</li>
</ul>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>Helm是一个kubernetes的包管理工具，就像Linux下的包管理器，如yum、apt等，可以很方便的将之前打包好的yaml文件部署到kubernetes上。<br>Helm有3个重要概念：</p>
<ul>
<li>helm：一个命令行客户端工具，主要用于kubernetes应用chart的创建、打包、发布和管理</li>
<li>chart：应用描述，一系列用于描述kubernetes资源相关文件的集合</li>
<li>release：基于chart的部署实体，一个chart被Helm运行后将会生成对应的一个release，将在kubernetes中创建出真实运行的资源对象</li>
</ul>
<h1 id="Helm-v3变化"><a href="#Helm-v3变化" class="headerlink" title="Helm v3变化"></a>Helm v3变化</h1><p>2019年11月13日，Helm团队发布Helm v3的第一个稳定版本<br>该版本主要变化如下：</p>
<ul>
<li>最明显的变化是Tiller删除<br><img src="1.png" alt="1"></li>
<li>release名称可以在不同的命名空间重用</li>
<li>支持将chart推动到Docker镜像仓库中</li>
<li>使用JSONSchema验证chart values</li>
<li>其他</li>
</ul>
<h1 id="Helm-客户端"><a href="#Helm-客户端" class="headerlink" title="Helm 客户端"></a>Helm 客户端</h1><h2 id="部署Helm客户端"><a href="#部署Helm客户端" class="headerlink" title="部署Helm客户端"></a>部署Helm客户端</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载Helm</span></span><br><span class="line">wget https://get.helm.sh/helm-v3.2.1-linux-amd64.tar.gz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压Helm到/usr/bin目录</span></span><br><span class="line">tar -zxvf helm-v3.2.1-linux-amd64.tar.gz</span><br><span class="line">cd linux-amd64/</span><br><span class="line">cp helm /usr/bin/</span><br></pre></td></tr></table></figure>

<h2 id="配置国内的chart仓库"><a href="#配置国内的chart仓库" class="headerlink" title="配置国内的chart仓库"></a>配置国内的chart仓库</h2><h3 id="仓库概述"><a href="#仓库概述" class="headerlink" title="仓库概述"></a>仓库概述</h3><ul>
<li>微软仓库：<a target="_blank" rel="noopener" href="http://mirror.azure.cn/kubernetes/charts%EF%BC%8C%E6%8E%A8%E8%8D%90%EF%BC%8C%E5%9F%BA%E6%9C%AC%E4%B8%8A%E5%AE%98%E7%BD%91%E4%B8%8A%E7%9A%84chart%E8%BF%99%E9%87%8C%E9%83%BD%E6%9C%89">http://mirror.azure.cn/kubernetes/charts，推荐，基本上官网上的chart这里都有</a></li>
<li>阿里云仓库：<a target="_blank" rel="noopener" href="https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts">https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</a></li>
<li>官方仓库：<a target="_blank" rel="noopener" href="https://hub.kubeapps.com/charts/incubator%EF%BC%8C%E5%BC%BA%E7%83%88%E4%B8%8D%E6%8E%A8%E8%8D%90">https://hub.kubeapps.com/charts/incubator，强烈不推荐</a></li>
</ul>
<h3 id="添加仓库"><a href="#添加仓库" class="headerlink" title="添加仓库"></a>添加仓库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加仓库命令</span></span><br><span class="line">helm repo add 仓库名 仓库地址</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新仓库命令</span></span><br><span class="line">helm repo update</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加并更新仓库</span></span><br><span class="line">helm repo add stable http://mirror.azure.cn/kubernetes/charts</span><br><span class="line">helm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span><br><span class="line">helm repo update</span><br></pre></td></tr></table></figure>

<h3 id="删除存储库"><a href="#删除存储库" class="headerlink" title="删除存储库"></a>删除存储库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm repo remove 仓库名</span><br></pre></td></tr></table></figure>

<h3 id="查看配置的存储库"><a href="#查看配置的存储库" class="headerlink" title="查看配置的存储库"></a>查看配置的存储库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm repo list</span><br></pre></td></tr></table></figure>

<h2 id="helm的常用命令"><a href="#helm的常用命令" class="headerlink" title="helm的常用命令"></a>helm的常用命令</h2><table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>create</td>
<td>创建一个chart并指定名字</td>
</tr>
<tr>
<td>dependency</td>
<td>管理chart依赖</td>
</tr>
<tr>
<td>get</td>
<td>下载一个release。可用的子命令：all、hooks、manifest、notes、values。</td>
</tr>
<tr>
<td>history</td>
<td>获取release历史</td>
</tr>
<tr>
<td>install</td>
<td>安装一个chart</td>
</tr>
<tr>
<td>list</td>
<td>列出release</td>
</tr>
<tr>
<td>package</td>
<td>将chart目录打包到chart存档文件中</td>
</tr>
<tr>
<td>pull</td>
<td>从远程仓库中下载chart并解压到本地。比如：helm install stable/mysql –untar</td>
</tr>
<tr>
<td>repo</td>
<td>添加、列出、移除、更新和索引chart仓库。可用的子命令：add、index、list、remove、update</td>
</tr>
<tr>
<td>rollback</td>
<td>从之前的版本回退</td>
</tr>
<tr>
<td>search</td>
<td>根据关键字搜索chart。可用的子命令：all、chart、readme、values</td>
</tr>
<tr>
<td>show</td>
<td>查看chart的详细信息。可用的子命令：all、chart、readme、values</td>
</tr>
<tr>
<td>status</td>
<td>显示已命名版本的状态</td>
</tr>
<tr>
<td>template</td>
<td>本地呈现模板</td>
</tr>
<tr>
<td>uninstall</td>
<td>卸载一个release</td>
</tr>
<tr>
<td>upgrade</td>
<td>更新一个release</td>
</tr>
<tr>
<td>version</td>
<td>查看Helm客户端版本</td>
</tr>
</tbody></table>
<h1 id="Helm-基本使用"><a href="#Helm-基本使用" class="headerlink" title="Helm 基本使用"></a>Helm 基本使用</h1><h2 id="使用chart部署一个应用"><a href="#使用chart部署一个应用" class="headerlink" title="使用chart部署一个应用"></a>使用chart部署一个应用</h2><h3 id="根据关键字搜索chart"><a href="#根据关键字搜索chart" class="headerlink" title="根据关键字搜索chart"></a>根据关键字搜索chart</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">语法</span></span><br><span class="line">helm search repo|hub chart名称</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">示例：查询名为weave的chart</span></span><br><span class="line">helm search repo weave</span><br></pre></td></tr></table></figure>

<h3 id="查看chart信息"><a href="#查看chart信息" class="headerlink" title="查看chart信息"></a>查看chart信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">helm show chart 仓库名/chart名称</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看名为stable的仓库中的名为mysql的chart</span></span><br><span class="line">helm show chart stable/mysql</span><br></pre></td></tr></table></figure>

<h3 id="安装chart，形成release"><a href="#安装chart，形成release" class="headerlink" title="安装chart，形成release"></a>安装chart，形成release</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">语法</span></span><br><span class="line">helm install 安装之后的名称 仓库名/chart的名称(即搜索之后的应用名称)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装stable/weave-scope，并将其命名为ui</span></span><br><span class="line">helm install ui stable/weave-scope</span><br></pre></td></tr></table></figure>

<h3 id="查看release列表"><a href="#查看release列表" class="headerlink" title="查看release列表"></a>查看release列表</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm list</span><br></pre></td></tr></table></figure>

<h3 id="查看已命名release的状态"><a href="#查看已命名release的状态" class="headerlink" title="查看已命名release的状态"></a>查看已命名release的状态</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">语法</span></span><br><span class="line">helm status 安装之后的名称</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看安装chart的release为ui的状态</span></span><br><span class="line">helm status ui</span><br></pre></td></tr></table></figure>

<h3 id="查看Service，并将其改为NodePort"><a href="#查看Service，并将其改为NodePort" class="headerlink" title="查看Service，并将其改为NodePort"></a>查看Service，并将其改为NodePort</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">语法</span></span><br><span class="line">kubectl edit svc xxx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看Service，并将其改为NodePort</span></span><br><span class="line">kubectl edit svc ui-weave-scope</span><br></pre></td></tr></table></figure>

<h2 id="安装前自定义chart配置选项"><a href="#安装前自定义chart配置选项" class="headerlink" title="安装前自定义chart配置选项"></a>安装前自定义chart配置选项</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p>自定义选项是因为并不是所有的chart都能按照默认配置运行成功，可能会需要一些环境依赖，例如PV。<br>所以我们需要自定义chart配置选项，安装过程中有两种方法可以传递配置数据：</p>
<ul>
<li>–values（或-f）：指定带有覆盖的YAML文件。这里可以多次指定，最右边的文件优先。</li>
<li>–set：在命令行上指定替代。如果两种都用，那么–set的优先级高。</li>
</ul>
<h3 id="–values的使用（不推荐，太麻烦）"><a href="#–values的使用（不推荐，太麻烦）" class="headerlink" title="–values的使用（不推荐，太麻烦）"></a>–values的使用（不推荐，太麻烦）</h3><blockquote>
<p>安装可能报错，需要自己手动安装PV。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">先将修改的变量写到一个文件中，并修改此文件</span></span><br><span class="line">helm show values stable/mysql &gt; config.yaml</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat config.yaml</span></span><br><span class="line"></span><br><span class="line">  <span class="string">--</span> <span class="string">修改部分</span></span><br><span class="line"><span class="attr">persistence:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">accessMode:</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">size:</span> <span class="string">8Gi</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mysqlUser:</span> <span class="string">&quot;k8s&quot;</span></span><br><span class="line"><span class="attr">mysqlPassword:</span> <span class="string">&quot;123456&quot;</span></span><br><span class="line"><span class="attr">mysqlDatabase:</span> <span class="string">&quot;k8s&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用--values来替换默认的配置</span></span><br><span class="line">helm install -f config.yaml self-mysql stable/mysql</span><br></pre></td></tr></table></figure>

<h3 id="命令行替代变量（推荐）"><a href="#命令行替代变量（推荐）" class="headerlink" title="命令行替代变量（推荐）"></a>命令行替代变量（推荐）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以使用命令行替代变量</span></span><br><span class="line">helm install db --set persistence.storageClass=&quot;managed-nfs-storage&quot; stable/mysql</span><br></pre></td></tr></table></figure>

<h1 id="构建一个Helm-Chart"><a href="#构建一个Helm-Chart" class="headerlink" title="构建一个Helm Chart"></a>构建一个Helm Chart</h1><h2 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用helm create创建chart</span></span><br><span class="line">helm create chart名称</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入自定义chart目录的templates目录中，修改其中的deployment.yaml和service.yaml等文件</span></span><br><span class="line">cd chart名称/templates</span><br></pre></td></tr></table></figure>
<p><img src="2.png" alt="2"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过刚才创建的chart目录，将其部署</span></span><br><span class="line">helm install xxx chart名称</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打包chart，让别人共享</span></span><br><span class="line">helm package chart名称</span><br></pre></td></tr></table></figure>

<h2 id="应用示例"><a href="#应用示例" class="headerlink" title="应用示例"></a>应用示例</h2><blockquote>
<p>示例：本人是在root目录下操作的</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建chart</span></span><br><span class="line">helm create nginx</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入chart目录，修改values.yaml文件，内容如下</span></span><br><span class="line"><span class="comment"># cd nginx</span></span><br><span class="line"><span class="comment"># vim values.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">tag:</span> <span class="number">1.17</span></span><br><span class="line"><span class="attr">serviceport:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">targetport:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">label:</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入templates目录</span></span><br><span class="line">cd templates/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除templates目录中的所有文件和文件夹</span></span><br><span class="line">rm -rf *</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改deployment.yaml文件，内容如下</span></span><br><span class="line"><span class="comment"># vim deployment.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> &#123;&#123; <span class="string">.Values.label</span> &#125;&#125;</span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;</span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> &#123;&#123; <span class="string">.Values.replicas</span> &#125;&#125;</span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> &#123;&#123; <span class="string">.Values.label</span> &#125;&#125;</span><br><span class="line">  <span class="attr">strategy:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> &#123;&#123; <span class="string">.Values.label</span> &#125;&#125;</span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">image:</span> &#123;&#123; <span class="string">.Values.image</span> &#125;&#125;<span class="string">:&#123;&#123;</span> <span class="string">.Values.tag</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">name:</span> &#123;&#123; <span class="string">.Values.image</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改service.yaml文件，内容如下</span></span><br><span class="line"><span class="comment"># vim service.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span>   <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> &#123;&#123; <span class="string">.Values.label</span> &#125;&#125;</span><br><span class="line">  <span class="attr">name:</span>  &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;</span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span>  <span class="attr">port:</span> &#123;&#123; <span class="string">.Values.serviceport</span> &#125;&#125;</span><br><span class="line">       <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">       <span class="attr">targetPort:</span> &#123;&#123; <span class="string">.Values.targetport</span> &#125;&#125;</span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> &#123;&#123; <span class="string">.Values.label</span> &#125;&#125;</span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换到chart目录的上一层目录</span></span><br><span class="line">cd ~</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装应用</span></span><br><span class="line">helm install nginx nginx/</span><br></pre></td></tr></table></figure>

<h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><p>Helm也提供了–dry-run和–debug调试参数，帮助你验证模板的正确性。<br>在执行helm install的时候带上这两个参数就可以把对应的values值和渲染的资源清单打印出来，而不是真正的做部署一个release。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install nginx nginx/ --dry-run --debug</span><br></pre></td></tr></table></figure>

<h2 id="内置对象"><a href="#内置对象" class="headerlink" title="内置对象"></a>内置对象</h2><p>上面我们使用的<code>&#123;&#123; .Release.Name &#125;&#125;</code>将release的名称插入到模板中，这里的Release就是Helm的内置对象，下面是一些常用的内置对象：</p>
<table>
<thead>
<tr>
<th>内置对象</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>Release.Name</td>
<td>release的名称</td>
</tr>
<tr>
<td>Release.Namespace</td>
<td>release的命名空间</td>
</tr>
<tr>
<td>Release.Service</td>
<td>release的服务的名称</td>
</tr>
<tr>
<td>Release.Revision</td>
<td>release的修订版本号，从1开始累加</td>
</tr>
</tbody></table>
<h2 id="Values"><a href="#Values" class="headerlink" title="Values"></a>Values</h2><p>Values对象是为Chart模板提供值，这个对象的值有4个来源</p>
<ul>
<li>chart包中的values.yaml文件</li>
<li>父chart包的values.yaml文件</li>
<li>通过helm install或者helm upgrade的-f或者–values参数传入的自定义的yaml文件</li>
<li>通过–set参数传入的值</li>
</ul>
<p>Chart的values.yaml提供的值可以被用户提供的values文件覆盖，而该文件同样可以被–set参数所覆盖，换言之，–set参数的优先级高</p>
<h2 id="升级、回滚和删除"><a href="#升级、回滚和删除" class="headerlink" title="升级、回滚和删除"></a>升级、回滚和删除</h2><h3 id="升级"><a href="#升级" class="headerlink" title="升级"></a>升级</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发布新版本的chart时，或者当我们需要更改发布的配置，可以使用helm upgrade命令</span></span><br><span class="line">helm upgrade --set imageTag=1.18 nginx nginx</span><br><span class="line"></span><br><span class="line">helm upgrade -f values.yaml nginx nginx</span><br></pre></td></tr></table></figure>
<h3 id="回滚"><a href="#回滚" class="headerlink" title="回滚"></a>回滚</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果在发布后没有达到预期的效果，则可以使用helm rollback回滚到之前的版本</span></span><br><span class="line">helm rollback nginx 1</span><br></pre></td></tr></table></figure>

<h3 id="卸载发行版本"><a href="#卸载发行版本" class="headerlink" title="卸载发行版本"></a>卸载发行版本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">卸载发行版本，可以使用helm uninstall命令</span></span><br><span class="line">helm uninstall nginx</span><br></pre></td></tr></table></figure>

<h3 id="卸载发行版本，可以使用helm-uninstall命令"><a href="#卸载发行版本，可以使用helm-uninstall命令" class="headerlink" title="卸载发行版本，可以使用helm uninstall命令"></a>卸载发行版本，可以使用helm uninstall命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看历史版本配置信息</span></span><br><span class="line">helm get all --revision 1 nginx</span><br></pre></td></tr></table></figure>

<h2 id="管道和函数"><a href="#管道和函数" class="headerlink" title="管道和函数"></a>管道和函数</h2><h3 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h3><p>在上面的案例中，其实是将值传递给模板引擎进行渲染，模板引擎还支持对拿到的数据进行二次处理<br>示例：从.Values中读取的值变成字符串，可以使用quote函数实现。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi templates/deployment.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 略</span></span><br><span class="line"><span class="attr">app:</span> &#123;&#123; <span class="string">quote</span>  <span class="string">.Values.label.app</span>    &#125;&#125;</span><br><span class="line"><span class="comment"># 略</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install --dry-run nginx ../nginx/ app:&quot;nginx&quot;</span><br></pre></td></tr></table></figure>
<p>quote  .Values.label.app将后面的值作为参数传递过quote函数。<br>模板函数调用语法为：functionName arg1 arg2…</p>
<h3 id="default函数"><a href="#default函数" class="headerlink" title="default函数"></a>default函数</h3><p>default函数运行在模板中指定默认值，以防止该值会忽略掉。如果忘记定义，执行helm install的时候会因为缺少字段而无法创建资源，这时就可以定义一个默认值了</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim templates/deployment.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> &#123;&#123; <span class="string">.Values.label</span> &#125;&#125;</span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;</span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> &#123;&#123; <span class="string">.Values.replicas</span> &#125;&#125;</span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> &#123;&#123; <span class="string">.Values.label</span> &#125;&#125;</span><br><span class="line">  <span class="attr">strategy:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> &#123;&#123; <span class="string">.Values.label</span> &#125;&#125;</span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">image:</span> &#123;&#123; <span class="string">.Values.image|</span> <span class="string">default</span> <span class="string">&quot;nginx&quot;</span> &#125;&#125;<span class="string">:&#123;&#123;</span> <span class="string">.Values.tag</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">name:</span> &#123;&#123; <span class="string">.Values.image</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 缩进函数</span></span><br><span class="line">&#123;&#123; <span class="string">.Values.resources</span> <span class="string">|</span> <span class="string">indent</span> <span class="number">12</span> &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 大写</span></span><br><span class="line">&#123;&#123; <span class="string">upper</span> <span class="string">.Values.resources</span> &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 首字母大写</span></span><br><span class="line">&#123;&#123; <span class="string">title</span> <span class="string">.Values.resources</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h1><h2 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h2><p>流程控制是为模板提供了一种能力，满足更复杂的数据逻辑处理<br>Helm模板语言提供以下流程控制语句：</p>
<ul>
<li>if/else条件块</li>
<li>with指定范围</li>
<li>range循环块</li>
</ul>
<h2 id="if-else"><a href="#if-else" class="headerlink" title="if/else"></a>if/else</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">if</span>/else块是用于在模板有条件的包含文本块的方法，条件块的基本结构如下</span></span><br><span class="line"></span><br><span class="line">&#123;&#123; if 条件表达式&#125;&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">xxx</span></span><br><span class="line">&#123;&#123; else if 条件表达式&#125;&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">xxx</span></span><br><span class="line">&#123;&#123; else &#125;&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">xxx</span></span><br><span class="line">&#123;&#123; end &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>条件判断：就是判断条件是否为真，如果值为以下几种情况则为false，否则为true:</p>
<ul>
<li>一个布尔类型的false</li>
<li>一个数字0</li>
<li>一个空的字符串</li>
<li>一个空的集合（map、slice、tuple、dict、array）</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> &#123;&#123; <span class="string">.Values.label</span> &#125;&#125;</span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;</span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> &#123;&#123; <span class="string">.Values.replicas</span> &#125;&#125;</span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> &#123;&#123; <span class="string">.Values.label</span> &#125;&#125;</span><br><span class="line">  <span class="attr">strategy:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> &#123;&#123; <span class="string">.Values.label</span> &#125;&#125;</span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">image:</span> &#123;&#123; <span class="string">.Values.image|</span> <span class="string">default</span> <span class="string">&quot;nginx&quot;</span> &#125;&#125;<span class="string">:&#123;&#123;</span> <span class="string">.Values.tag</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">name:</span> &#123;&#123; <span class="string">.Values.image</span> &#125;&#125;</span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            &#123;&#123; <span class="string">if</span> <span class="string">eq</span> <span class="string">.Values.devops</span> <span class="string">&quot;k8s&quot;</span> &#125;&#125;</span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name :</span> <span class="string">hello</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">&quot;123&quot;</span></span><br><span class="line">            &#123;&#123; <span class="string">else</span> &#125;&#125;</span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name :</span> <span class="string">hello</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">&quot;456&quot;</span></span><br><span class="line">            &#123;&#123; <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>还可以使用ne、lt、gt、and、or等运算符</p>
</blockquote>
<p>通过模板引擎渲染一下，会得到如下的结果:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install --dry-run nginx nginx</span><br></pre></td></tr></table></figure>

<p><img src="3.png" alt="3"></p>
<p>可以看到渲染出来会有多余的空行，这是因为当模板引擎运行的时候，会将控制指令删除，所以之前占的位置也就空白了，需要使用<code>&#123;&#123;- if ...&#125;&#125;</code>的方式消除此空行</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> &#123;&#123; <span class="string">.Values.label</span> &#125;&#125;</span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;</span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> &#123;&#123; <span class="string">.Values.replicas</span> &#125;&#125;</span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> &#123;&#123; <span class="string">.Values.label</span> &#125;&#125;</span><br><span class="line">  <span class="attr">strategy:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> &#123;&#123; <span class="string">.Values.label</span> &#125;&#125;</span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">image:</span> &#123;&#123; <span class="string">.Values.image|</span> <span class="string">default</span> <span class="string">&quot;nginx&quot;</span> &#125;&#125;<span class="string">:&#123;&#123;</span> <span class="string">.Values.tag</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">name:</span> &#123;&#123; <span class="string">.Values.image</span> &#125;&#125;</span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            &#123;&#123;<span class="bullet">-</span> <span class="string">if</span> <span class="string">eq</span> <span class="string">.Values.devops</span> <span class="string">&quot;k8s&quot;</span> &#125;&#125;</span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name :</span> <span class="string">hello</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">&quot;123&quot;</span></span><br><span class="line">            &#123;&#123;<span class="bullet">-</span> <span class="string">else</span> &#125;&#125;</span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name :</span> <span class="string">hello</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">&quot;456&quot;</span></span><br><span class="line">            &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过模板引擎渲染一下，会得到如下的结果</span></span><br><span class="line">helm install --dry-run nginx nginx</span><br></pre></td></tr></table></figure>
<p><img src="4.png" alt="4"><br>如果使用了<code>&#123;&#123;- if ... -&#125;&#125;</code>那么就需要谨慎了，比如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> &#123;&#123; <span class="string">.Values.label</span> &#125;&#125;</span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;</span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> &#123;&#123; <span class="string">.Values.replicas</span> &#125;&#125;</span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> &#123;&#123; <span class="string">.Values.label</span> &#125;&#125;</span><br><span class="line">  <span class="attr">strategy:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> &#123;&#123; <span class="string">.Values.label</span> &#125;&#125;</span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">image:</span> &#123;&#123; <span class="string">.Values.image|</span> <span class="string">default</span> <span class="string">&quot;nginx&quot;</span> &#125;&#125;<span class="string">:&#123;&#123;</span> <span class="string">.Values.tag</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">name:</span> &#123;&#123; <span class="string">.Values.image</span> &#125;&#125;</span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            &#123;&#123;<span class="bullet">-</span> <span class="string">if</span> <span class="string">eq</span> <span class="string">.Values.devops</span> <span class="string">&quot;k8s&quot;</span> <span class="string">-</span>&#125;&#125;</span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name :</span> <span class="string">hello</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">&quot;123&quot;</span></span><br><span class="line">            &#123;&#123;<span class="bullet">-</span> <span class="string">else</span> &#125;&#125;</span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name :</span> <span class="string">hello</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">&quot;456&quot;</span></span><br><span class="line">            &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>通过模板引擎渲染一下，会得到如下的结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install --dry-run nginx nginx</span><br></pre></td></tr></table></figure>

<p>相当于下面这种格式：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">NAME:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">LAST DEPLOYED:</span> <span class="string">Mon</span> <span class="string">Jan</span> <span class="number">11</span> <span class="number">20</span><span class="string">:46:10</span> <span class="number">2021</span></span><br><span class="line"><span class="attr">NAMESPACE:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">STATUS:</span> <span class="string">pending-install</span></span><br><span class="line"><span class="attr">REVISION:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">TEST SUITE:</span> <span class="string">None</span></span><br><span class="line"><span class="attr">HOOKS:</span></span><br><span class="line"><span class="attr">MANIFEST:</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: nginx/templates/service.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span>   <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span> </span><br><span class="line">  <span class="attr">name:</span>  <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span> </span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span>  <span class="attr">port:</span> <span class="number">80</span> </span><br><span class="line">       <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">       <span class="attr">targetPort:</span> <span class="number">80</span> </span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span> </span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: nginx/templates/deployment.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">strategy:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx:1.17</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">          <span class="attr">env: - name: hello value:</span> <span class="number">123</span></span><br></pre></td></tr></table></figure>
<p>当然不对，因为<code>&#123;&#123;- if ... -&#125;&#125;</code>删除了双方的换行符。</p>
<h2 id="range"><a href="#range" class="headerlink" title="range"></a>range</h2><p>在Helm模板语言中，使用range关键字来进行循环操作<br>在values.yaml中添加一个变量列表</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="number">2</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>循环打印该列表</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span>    &#123;&#123;   <span class="string">.Release.Name</span>    &#125;&#125; </span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">test:</span>    </span><br><span class="line">    &#123;&#123;<span class="bullet">-</span> <span class="string">range</span> <span class="string">.</span> <span class="string">Values.test</span> &#125;&#125;</span><br><span class="line">      &#123;&#123;   <span class="string">.</span>    &#125;&#125;</span><br><span class="line">    &#123;&#123;<span class="bullet">-</span>   <span class="string">end</span>   &#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="with"><a href="#with" class="headerlink" title="with"></a>with</h2><p>with可以用来控制变量作用域<br>在前面我们使用<code>&#123;&#123; .Release.xxx &#125;&#125;</code>或者<code>&#123;&#123; .Values.xxx &#125;&#125;</code>，其中.就是表示对当前范围的引用，<code>.values</code>就是告诉模板在当前范围中查找<code>Values</code>对象的值。<br>with语句就可以用来控制变量的作用域范围，其语法和一个简单的if语句类似：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; with 条件表达式 &#125;&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">xxx</span></span><br><span class="line">&#123;&#123; end &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>with语句可以允许将当前范围的.设置为特定的对象，比如我们前面一直使用的.Values.label，我们可以使用with来将.范围指向.Values.label</p>
<p>示例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># values.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">nodeSelector:</span></span><br><span class="line">  <span class="attr">team:</span> <span class="string">a</span></span><br><span class="line">  <span class="attr">gpu:</span>   <span class="literal">yes</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># deployment.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span>   <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span>   <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      &#123;&#123;<span class="bullet">-</span> <span class="string">with</span> <span class="string">.Values.nodeSelector</span> &#125;&#125;</span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">team:</span> &#123;&#123;  <span class="string">.team</span> &#125;&#125;</span><br><span class="line">        <span class="attr">gpu:</span> &#123;&#123;  <span class="string">.gpu</span>  &#125;&#125;</span><br><span class="line">      &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="命名模版"><a href="#命名模版" class="headerlink" title="命名模版"></a>命名模版</h2><p>需要复用代码的地方可以使用命名模板。<br>命名模板：使用define定义，template引入，在templates目录中默认下划线开头的文件为公共模板（比如_helpers.tpl）<br>示例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># _helpers.tpl</span></span><br><span class="line"></span><br><span class="line">&#123;&#123;<span class="bullet">-</span>   <span class="string">define</span>   <span class="string">&quot;demo.fullname&quot;</span>   <span class="string">-</span>&#125;&#125;</span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">.Chart.Name</span> <span class="string">-</span>&#125;&#125;<span class="string">-&#123;&#123;</span> <span class="string">.Release.Name</span> <span class="string">&#125;&#125;</span></span><br><span class="line">&#123;&#123;<span class="bullet">-</span>   <span class="string">end</span>   <span class="string">-</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># deployment.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span>   <span class="string">apps/v1</span> </span><br><span class="line"><span class="attr">kind:</span>   <span class="string">Deployment</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span>  &#123;&#123;   <span class="string">template&quot;demo.fullname&quot;</span>   <span class="string">.</span>    &#125;&#125;</span><br><span class="line"><span class="comment"># 其他略</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>template指令是将一个模板包含在另一个模板中的方法。但是，template函数不能用于Go模板管道，为了解决该问题，增加了include功能。</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># _helpers.tpl</span></span><br><span class="line"></span><br><span class="line">&#123;&#123;<span class="bullet">-</span>   <span class="string">define</span>   <span class="string">&quot;demo.labels&quot;</span>    <span class="string">-</span>&#125;&#125;</span><br><span class="line"><span class="attr">app:</span>   &#123;&#123;   <span class="string">template&quot;demo.fullname&quot;</span>   <span class="string">.</span>   &#125;&#125;</span><br><span class="line"><span class="attr">chart:</span>   <span class="string">&quot;<span class="template-variable">&#123;&#123;   .Chart.Name   &#125;&#125;</span>-<span class="template-variable">&#123;&#123;    .Chart.Version   &#125;&#125;</span>&quot;</span> </span><br><span class="line"><span class="attr">release:</span>   <span class="string">&quot;<span class="template-variable">&#123;&#123;   .Release.Name   &#125;&#125;</span>&quot;</span></span><br><span class="line">&#123;&#123;<span class="bullet">-</span>   <span class="string">end</span>   <span class="string">-</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># deployment.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span>   <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span>   <span class="string">Deployment</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span>    &#123;&#123;   <span class="string">include&quot;demo.fullname&quot;</span>   <span class="string">.</span>    &#125;&#125; </span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    &#123;&#123;<span class="bullet">-</span>   <span class="string">include</span>   <span class="string">&quot;demo.labels&quot;</span>   <span class="string">.</span>    <span class="string">|</span>   <span class="string">nindent</span>   <span class="number">4</span>    &#125;&#125;</span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面包含一个名为demo.labels的模板，然后将值  . 传递给模板，最后将该模板的 输出传递给nindent函数</p>
</blockquote>
<h1 id="开发自己的chart"><a href="#开发自己的chart" class="headerlink" title="开发自己的chart"></a>开发自己的chart</h1><ul>
<li>创建模板</li>
<li>修改Chart.yaml，Values.yaml，添加常用的变量</li>
<li>在templates目录下创建部署镜像所需要的yaml文件，并使用变量引用yaml文件里面经常变动的字段</li>
</ul>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
		data-enable='true'
        data-ae='true'
        data-ci='aae5f1ef39ad91ac18d0'
        data-cs='9bdc46e39856d885ab0ccb5de3ef37351d543ec1'
        data-r='blog.github.io'
        data-o='bob-zou'
        data-a='bob-zou'
        data-d='false'
    >查看评论</div>


    </div>
    
</div>


    </div>
    <center>
        <p class="footerlinks">
            <a href="#" class="iconfont icon-null"></a>
            
                <a href="https://github.com/bob-zou" title="github" class="iconfont icon-github" target="_blank" rel="noopener"> </a>
            
                <a href="https://cdn.jsdelivr.net/gh/bob-zou/blog.github.io/img/wechat.jpg" title="wechat" class="iconfont icon-wechat" target="_blank" rel="noopener"> </a>
            
                <a href="mailto:zyp19901009@163.com" title="email" class="iconfont icon-email" target="_blank" rel="noopener"> </a>
            
            <a href="#" class="iconfont icon-null"></a>
        </p>

        <p id="copyright">
            &copy; 2023 Bob Zou 书山有路勤为径，学海无涯苦作舟
        </p>
    </center>
</div>

</body>

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>





<!-- Google Analytics -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MTN9237PJK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MTN9237PJK');
</script>
<!-- End Google Analytics -->


</html>
